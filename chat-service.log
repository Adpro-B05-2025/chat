2025-06-04 20:06:57.698 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.2.Final
2025-06-04 20:06:57.724 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - Starting ChatApplication using Java 21.0.2 with PID 92196 (/Users/karolinajocelyn/IdeaProjects/chat/build/classes/java/main started by karolinajocelyn in /Users/karolinajocelyn/IdeaProjects/chat)
2025-06-04 20:06:57.725 [restartedMain] DEBUG i.a.u.c.advprog.chat.ChatApplication - Running with Spring Boot v3.4.4, Spring v6.2.5
2025-06-04 20:06:57.725 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - The following 1 profile is active: "dev"
2025-06-04 20:06:57.763 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-04 20:06:57.763 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-04 20:06:58.209 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-04 20:06:58.241 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 27 ms. Found 2 JPA repository interfaces.
2025-06-04 20:06:58.632 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8082 (http)
2025-06-04 20:06:58.638 [restartedMain] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-0.0.0.0-8082"]
2025-06-04 20:06:58.638 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-04 20:06:58.638 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.39]
2025-06-04 20:06:58.653 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-04 20:06:58.654 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 890 ms
2025-06-04 20:06:58.737 [restartedMain] DEBUG i.a.u.c.a.c.security.JwtAuthFilter - Filter 'jwtAuthFilter' configured for use
2025-06-04 20:06:58.795 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-04 20:06:58.822 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.11.Final
2025-06-04 20:06:58.836 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-04 20:06:58.960 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-04 20:06:58.972 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-04 20:07:01.382 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@76837e81
2025-06-04 20:07:01.383 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-04 20:07:01.467 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-04 20:07:01.545 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.5
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-04 20:07:01.893 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-04 20:07:02.087 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-04 20:07:02.452 [restartedMain] INFO  i.a.u.c.a.c.c.ChatWebSocketController - ChatWebSocketController initialized
2025-06-04 20:07:02.483 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-04 20:07:02.509 [restartedMain] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 57143f0b-5fa7-4c5d-a9d0-9f57b045e81e

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-04 20:07:02.525 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-06-04 20:07:02.806 [restartedMain] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoints beneath base path '/actuator'
2025-06-04 20:07:02.862 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, JwtAuthFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-06-04 20:07:03.009 [restartedMain] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-06-04 20:07:03.166 [restartedMain] INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:postgresql://ep-odd-art-a1mbxvwl-pooler.ap-southeast-1.aws.neon.tech/neondb'
2025-06-04 20:07:03.205 [restartedMain] WARN  o.s.b.d.a.OptionalLiveReloadServer - Unable to start LiveReload server
2025-06-04 20:07:03.246 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-04 20:07:03.247 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@45790ed7]]
2025-06-04 20:07:03.247 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-04 20:07:03.247 [restartedMain] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-0.0.0.0-8082"]
2025-06-04 20:07:03.254 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8082 (http) with context path '/'
2025-06-04 20:07:03.268 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - Started ChatApplication in 5.812 seconds (process running for 6.11)
2025-06-04 20:07:43.175 [http-nio-0.0.0.0-8082-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-04 20:07:43.175 [http-nio-0.0.0.0-8082-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-04 20:07:43.180 [http-nio-0.0.0.0-8082-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 5 ms
2025-06-04 20:07:43.218 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/chat
2025-06-04 20:07:43.229 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:07:43.243 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8082/api/chat?continue to session
2025-06-04 20:07:43.243 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.s.w.a.Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
2025-06-04 20:07:43.252 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /error
2025-06-04 20:07:43.253 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:07:43.254 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8082/error?continue to session
2025-06-04 20:07:43.254 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.s.w.a.Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
2025-06-04 20:08:03.409 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-06-04 20:11:01.226 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts?userId=2
2025-06-04 20:11:01.359 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts?userId=2
2025-06-04 20:11:01.429 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.c.ChatRestController - START getContacts for userId=2
2025-06-04 20:11:01.734 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Found 1 rooms for user 2
2025-06-04 20:11:01.734 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: contactId=1
2025-06-04 20:11:01.734 [http-nio-0.0.0.0-8082-exec-4] WARN  i.a.u.c.a.c.s.AuthProfileService - No auth token provided for getUserName
2025-06-04 20:11:01.735 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Contact name for 1 => User 1
2025-06-04 20:11:01.806 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: 3 messages loaded
2025-06-04 20:11:01.806 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Added ContactResponse: ContactResponse{contactId=1, contactName='User 1', roomId=1, lastMessage='gkbg', lastMessageTime=2025-05-27T16:44:02.885009}
2025-06-04 20:11:01.807 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Contacts sorted by lastMessageTime
2025-06-04 20:11:01.807 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.c.ChatRestController - END getContacts for user 2 — returning 1 contacts
2025-06-04 20:11:01.861 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:01.867 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts?userId=2
2025-06-04 20:11:01.868 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts?userId=2
2025-06-04 20:11:01.869 [http-nio-0.0.0.0-8082-exec-5] INFO  i.a.u.c.a.c.c.ChatRestController - START getContacts for userId=2
2025-06-04 20:11:01.934 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.c.ChatRestController - Found 1 rooms for user 2
2025-06-04 20:11:01.934 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: contactId=1
2025-06-04 20:11:01.934 [http-nio-0.0.0.0-8082-exec-5] WARN  i.a.u.c.a.c.s.AuthProfileService - No auth token provided for getUserName
2025-06-04 20:11:01.934 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.c.ChatRestController - Contact name for 1 => User 1
2025-06-04 20:11:02.003 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: 3 messages loaded
2025-06-04 20:11:02.003 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.c.ChatRestController - Added ContactResponse: ContactResponse{contactId=1, contactName='User 1', roomId=1, lastMessage='gkbg', lastMessageTime=2025-05-27T16:44:02.885009}
2025-06-04 20:11:02.003 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.c.ChatRestController - Contacts sorted by lastMessageTime
2025-06-04 20:11:02.003 [http-nio-0.0.0.0-8082-exec-5] INFO  i.a.u.c.a.c.c.ChatRestController - END getContacts for user 2 — returning 1 contacts
2025-06-04 20:11:02.004 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:04.293 [http-nio-0.0.0.0-8082-exec-6] INFO  o.a.tomcat.util.http.parser.Cookie - A cookie header was received [last_login="2024-10-27 03:30:12.196746";] that contained an invalid cookie. That cookie will be ignored.
 Note: further occurrences of this error will be logged at DEBUG level.
2025-06-04 20:11:04.300 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ws-chat/info?t=1749042664254
2025-06-04 20:11:04.304 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ws-chat/info?t=1749042664254
2025-06-04 20:11:04.310 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:04.319 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ws-chat/131/zxi3fnqu/websocket
2025-06-04 20:11:04.323 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ws-chat/131/zxi3fnqu/websocket
2025-06-04 20:11:04.344 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:04.530 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: CONNECT on thread: http-nio-0.0.0.0-8082-exec-8
2025-06-04 20:11:04.530 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:04.530 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:04.530 [http-nio-0.0.0.0-8082-exec-8] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP CONNECT
2025-06-04 20:11:04.530 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Authorization headers: [Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQ5MDIzODk5LCJleHAiOjE3NDkxMTAyOTl9.Zia2plOhPwYiyUyrxmVsOrSDHr8Ix3hgODBWiiA_v-s]
2025-06-04 20:11:04.530 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Extracted token: eyJhbGciOiJIUzI1NiJ9...
2025-06-04 20:11:04.570 [http-nio-0.0.0.0-8082-exec-8] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - JWT token is valid
2025-06-04 20:11:04.574 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Extracted userId: 2, username: 2
2025-06-04 20:11:04.575 [http-nio-0.0.0.0-8082-exec-8] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully set user principal and session attributes for userId: 2
2025-06-04 20:11:04.587 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-9
2025-06-04 20:11:04.588 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.init.1
2025-06-04 20:11:04.588 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:04.589 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:04.589 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:04.589 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:04.589 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:04.589 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SEND on thread: http-nio-0.0.0.0-8082-exec-9
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /app/chat.init.1
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP SEND to destination: /app/chat.init.1
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing chat init request
2025-06-04 20:11:04.590 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Target User ID: 1
2025-06-04 20:11:04.591 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current User ID: 2
2025-06-04 20:11:04.591 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Chat init request authorized for user 2 with target user 1
2025-06-04 20:11:04.591 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:04.607 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - initRoom called - targetUserId=1
2025-06-04 20:11:04.607 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Session attributes on init: {USER_ID=2, USERNAME=2, AUTH_TOKEN=Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQ5MDIzODk5LCJleHAiOjE3NDkxMTAyOTl9.Zia2plOhPwYiyUyrxmVsOrSDHr8Ix3hgODBWiiA_v-s}
2025-06-04 20:11:04.607 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved userId from session attributes: 2
2025-06-04 20:11:04.607 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved auth token from session attributes: present
2025-06-04 20:11:04.607 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Current User ID for initRoom: 2
2025-06-04 20:11:04.607 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Auth token present: true
2025-06-04 20:11:04.639 [clientInboundChannel-7] INFO  i.a.u.c.a.c.service.ChatRoomService - Creating chat room between users 2 and 1
2025-06-04 20:11:04.661 [clientInboundChannel-7] DEBUG o.s.web.client.RestTemplate - HTTP GET http://localhost:8081/api/caregiver/2
2025-06-04 20:11:04.664 [clientInboundChannel-7] DEBUG o.s.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-06-04 20:11:04.687 [clientInboundChannel-7] DEBUG o.s.web.client.RestTemplate - Response 200 OK
2025-06-04 20:11:04.690 [clientInboundChannel-7] DEBUG o.s.web.client.RestTemplate - Reading to [java.util.Map<?, ?>]
2025-06-04 20:11:04.699 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.service.ChatRoomService - User 2 is a caregiver
2025-06-04 20:11:04.699 [clientInboundChannel-7] INFO  i.a.u.c.a.c.service.ChatRoomService - Room assignment - Patient: 1, Caregiver: 2
2025-06-04 20:11:04.740 [clientInboundChannel-7] INFO  i.a.u.c.a.c.service.ChatRoomService - Found existing room with ID: 1
2025-06-04 20:11:04.778 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Room created/found with ID: 1
2025-06-04 20:11:04.785 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - initRoom completed successfully for roomId=1
2025-06-04 20:11:04.785 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Cleared thread-local auth token
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.1.messages
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.1.updates
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:04.788 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SEND on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /app/chat.history.1
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP SEND to destination: /app/chat.history.1
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing room action request
2025-06-04 20:11:04.789 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Room ID: 1
2025-06-04 20:11:04.877 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User 2 checking membership in room 1 (pacillian: 1, caregiver: 2)
2025-06-04 20:11:04.878 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Room action authorized for user 2 in room 1
2025-06-04 20:11:04.878 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:04.879 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: UNSUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:04.879 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:04.879 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:04.879 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:04.879 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:04.879 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:04.880 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:04.880 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:04.880 [clientInboundChannel-16] INFO  i.a.u.c.a.c.c.ChatWebSocketController - history called - roomId=1
2025-06-04 20:11:04.881 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved userId from session attributes: 2
2025-06-04 20:11:04.881 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - User 2 requesting history for room 1
2025-06-04 20:11:04.953 [clientInboundChannel-16] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Retrieved 3 messages for room 1
2025-06-04 20:11:04.960 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - history completed - sent 3 messages for roomId=1
2025-06-04 20:11:11.059 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts?userId=2
2025-06-04 20:11:11.074 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts?userId=2
2025-06-04 20:11:11.086 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.c.ChatRestController - START getContacts for userId=2
2025-06-04 20:11:11.213 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Found 1 rooms for user 2
2025-06-04 20:11:11.213 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: contactId=1
2025-06-04 20:11:11.213 [http-nio-0.0.0.0-8082-exec-4] WARN  i.a.u.c.a.c.s.AuthProfileService - No auth token provided for getUserName
2025-06-04 20:11:11.213 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Contact name for 1 => User 1
2025-06-04 20:11:11.288 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: 3 messages loaded
2025-06-04 20:11:11.288 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Added ContactResponse: ContactResponse{contactId=1, contactName='User 1', roomId=1, lastMessage='gkbg', lastMessageTime=2025-05-27T16:44:02.885009}
2025-06-04 20:11:11.289 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Contacts sorted by lastMessageTime
2025-06-04 20:11:11.289 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.c.ChatRestController - END getContacts for user 2 — returning 1 contacts
2025-06-04 20:11:11.293 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:11.295 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts?userId=2
2025-06-04 20:11:11.296 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts?userId=2
2025-06-04 20:11:11.297 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.c.ChatRestController - START getContacts for userId=2
2025-06-04 20:11:11.367 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Found 1 rooms for user 2
2025-06-04 20:11:11.368 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: contactId=1
2025-06-04 20:11:11.368 [http-nio-0.0.0.0-8082-exec-4] WARN  i.a.u.c.a.c.s.AuthProfileService - No auth token provided for getUserName
2025-06-04 20:11:11.368 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Contact name for 1 => User 1
2025-06-04 20:11:11.433 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: 3 messages loaded
2025-06-04 20:11:11.434 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Added ContactResponse: ContactResponse{contactId=1, contactName='User 1', roomId=1, lastMessage='gkbg', lastMessageTime=2025-05-27T16:44:02.885009}
2025-06-04 20:11:11.434 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Contacts sorted by lastMessageTime
2025-06-04 20:11:11.434 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.c.ChatRestController - END getContacts for user 2 — returning 1 contacts
2025-06-04 20:11:11.437 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:11.972 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ws-chat/info?t=1749042671959
2025-06-04 20:11:11.996 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ws-chat/info?t=1749042671959
2025-06-04 20:11:12.000 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:12.013 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ws-chat/991/upqczg5n/websocket
2025-06-04 20:11:12.014 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ws-chat/991/upqczg5n/websocket
2025-06-04 20:11:12.015 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:12.025 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: CONNECT on thread: http-nio-0.0.0.0-8082-exec-8
2025-06-04 20:11:12.025 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:12.025 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: upqczg5n
2025-06-04 20:11:12.025 [http-nio-0.0.0.0-8082-exec-8] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP CONNECT
2025-06-04 20:11:12.025 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Authorization headers: [Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQ5MDIzODk5LCJleHAiOjE3NDkxMTAyOTl9.Zia2plOhPwYiyUyrxmVsOrSDHr8Ix3hgODBWiiA_v-s]
2025-06-04 20:11:12.025 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Extracted token: eyJhbGciOiJIUzI1NiJ9...
2025-06-04 20:11:12.029 [http-nio-0.0.0.0-8082-exec-8] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - JWT token is valid
2025-06-04 20:11:12.031 [http-nio-0.0.0.0-8082-exec-8] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Extracted userId: 2, username: 2
2025-06-04 20:11:12.031 [http-nio-0.0.0.0-8082-exec-8] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully set user principal and session attributes for userId: 2
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-9
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.init.1
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: upqczg5n
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SEND on thread: http-nio-0.0.0.0-8082-exec-9
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /app/chat.init.1
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: upqczg5n
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP SEND to destination: /app/chat.init.1
2025-06-04 20:11:12.035 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing chat init request
2025-06-04 20:11:12.036 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Target User ID: 1
2025-06-04 20:11:12.036 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current User ID: 2
2025-06-04 20:11:12.036 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Chat init request authorized for user 2 with target user 1
2025-06-04 20:11:12.036 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:12.037 [clientInboundChannel-10] INFO  i.a.u.c.a.c.c.ChatWebSocketController - initRoom called - targetUserId=1
2025-06-04 20:11:12.037 [clientInboundChannel-10] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Session attributes on init: {USER_ID=2, USERNAME=2, AUTH_TOKEN=Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQ5MDIzODk5LCJleHAiOjE3NDkxMTAyOTl9.Zia2plOhPwYiyUyrxmVsOrSDHr8Ix3hgODBWiiA_v-s}
2025-06-04 20:11:12.037 [clientInboundChannel-10] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved userId from session attributes: 2
2025-06-04 20:11:12.037 [clientInboundChannel-10] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved auth token from session attributes: present
2025-06-04 20:11:12.037 [clientInboundChannel-10] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Current User ID for initRoom: 2
2025-06-04 20:11:12.037 [clientInboundChannel-10] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Auth token present: true
2025-06-04 20:11:12.073 [clientInboundChannel-10] INFO  i.a.u.c.a.c.service.ChatRoomService - Creating chat room between users 2 and 1
2025-06-04 20:11:12.075 [clientInboundChannel-10] DEBUG o.s.web.client.RestTemplate - HTTP GET http://localhost:8081/api/caregiver/2
2025-06-04 20:11:12.075 [clientInboundChannel-10] DEBUG o.s.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-06-04 20:11:12.141 [clientInboundChannel-10] DEBUG o.s.web.client.RestTemplate - Response 200 OK
2025-06-04 20:11:12.142 [clientInboundChannel-10] DEBUG o.s.web.client.RestTemplate - Reading to [java.util.Map<?, ?>]
2025-06-04 20:11:12.142 [clientInboundChannel-10] DEBUG i.a.u.c.a.c.service.ChatRoomService - User 2 is a caregiver
2025-06-04 20:11:12.142 [clientInboundChannel-10] INFO  i.a.u.c.a.c.service.ChatRoomService - Room assignment - Patient: 1, Caregiver: 2
2025-06-04 20:11:12.175 [clientInboundChannel-10] INFO  i.a.u.c.a.c.service.ChatRoomService - Found existing room with ID: 1
2025-06-04 20:11:12.202 [clientInboundChannel-10] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Room created/found with ID: 1
2025-06-04 20:11:12.202 [clientInboundChannel-10] INFO  i.a.u.c.a.c.c.ChatWebSocketController - initRoom completed successfully for roomId=1
2025-06-04 20:11:12.202 [clientInboundChannel-10] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Cleared thread-local auth token
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.1.messages
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: upqczg5n
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.1.updates
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: upqczg5n
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SEND on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /app/chat.history.1
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: upqczg5n
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:12.204 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:12.205 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP SEND to destination: /app/chat.history.1
2025-06-04 20:11:12.205 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing room action request
2025-06-04 20:11:12.205 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Room ID: 1
2025-06-04 20:11:12.270 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User 2 checking membership in room 1 (pacillian: 1, caregiver: 2)
2025-06-04 20:11:12.270 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Room action authorized for user 2 in room 1
2025-06-04 20:11:12.270 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:12.271 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: UNSUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:12.271 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:12.271 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: upqczg5n
2025-06-04 20:11:12.271 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:12.271 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:12.271 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:12.271 [clientInboundChannel-16] INFO  i.a.u.c.a.c.c.ChatWebSocketController - history called - roomId=1
2025-06-04 20:11:12.271 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved userId from session attributes: 2
2025-06-04 20:11:12.271 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:12.271 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:12.271 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - User 2 requesting history for room 1
2025-06-04 20:11:12.346 [clientInboundChannel-16] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Retrieved 3 messages for room 1
2025-06-04 20:11:12.348 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - history completed - sent 3 messages for roomId=1
2025-06-04 20:11:17.358 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: DISCONNECT on thread: http-nio-0.0.0.0-8082-exec-5
2025-06-04 20:11:17.359 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:17.359 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: upqczg5n
2025-06-04 20:11:17.359 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:17.359 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:17.359 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:17.359 [http-nio-0.0.0.0-8082-exec-5] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:17.359 [http-nio-0.0.0.0-8082-exec-5] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:18.002 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts?userId=2
2025-06-04 20:11:18.007 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts?userId=2
2025-06-04 20:11:18.032 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.c.ChatRestController - START getContacts for userId=2
2025-06-04 20:11:18.143 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Found 1 rooms for user 2
2025-06-04 20:11:18.143 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: contactId=1
2025-06-04 20:11:18.143 [http-nio-0.0.0.0-8082-exec-4] WARN  i.a.u.c.a.c.s.AuthProfileService - No auth token provided for getUserName
2025-06-04 20:11:18.143 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Contact name for 1 => User 1
2025-06-04 20:11:18.208 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: 3 messages loaded
2025-06-04 20:11:18.208 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Added ContactResponse: ContactResponse{contactId=1, contactName='User 1', roomId=1, lastMessage='gkbg', lastMessageTime=2025-05-27T16:44:02.885009}
2025-06-04 20:11:18.210 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.c.ChatRestController - Contacts sorted by lastMessageTime
2025-06-04 20:11:18.210 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.c.ChatRestController - END getContacts for user 2 — returning 1 contacts
2025-06-04 20:11:18.221 [http-nio-0.0.0.0-8082-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:18.222 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts?userId=2
2025-06-04 20:11:18.224 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts?userId=2
2025-06-04 20:11:18.226 [http-nio-0.0.0.0-8082-exec-6] INFO  i.a.u.c.a.c.c.ChatRestController - START getContacts for userId=2
2025-06-04 20:11:18.296 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.c.ChatRestController - Found 1 rooms for user 2
2025-06-04 20:11:18.296 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: contactId=1
2025-06-04 20:11:18.296 [http-nio-0.0.0.0-8082-exec-6] WARN  i.a.u.c.a.c.s.AuthProfileService - No auth token provided for getUserName
2025-06-04 20:11:18.296 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.c.ChatRestController - Contact name for 1 => User 1
2025-06-04 20:11:18.375 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: 3 messages loaded
2025-06-04 20:11:18.375 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.c.ChatRestController - Added ContactResponse: ContactResponse{contactId=1, contactName='User 1', roomId=1, lastMessage='gkbg', lastMessageTime=2025-05-27T16:44:02.885009}
2025-06-04 20:11:18.375 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.c.ChatRestController - Contacts sorted by lastMessageTime
2025-06-04 20:11:18.375 [http-nio-0.0.0.0-8082-exec-6] INFO  i.a.u.c.a.c.c.ChatRestController - END getContacts for user 2 — returning 1 contacts
2025-06-04 20:11:18.380 [http-nio-0.0.0.0-8082-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:18.390 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts?userId=2
2025-06-04 20:11:18.392 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts?userId=2
2025-06-04 20:11:18.393 [http-nio-0.0.0.0-8082-exec-7] INFO  i.a.u.c.a.c.c.ChatRestController - START getContacts for userId=2
2025-06-04 20:11:18.455 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.c.ChatRestController - Found 1 rooms for user 2
2025-06-04 20:11:18.455 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: contactId=1
2025-06-04 20:11:18.455 [http-nio-0.0.0.0-8082-exec-7] WARN  i.a.u.c.a.c.s.AuthProfileService - No auth token provided for getUserName
2025-06-04 20:11:18.455 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.c.ChatRestController - Contact name for 1 => User 1
2025-06-04 20:11:18.524 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.c.ChatRestController - Room 1: 3 messages loaded
2025-06-04 20:11:18.524 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.c.ChatRestController - Added ContactResponse: ContactResponse{contactId=1, contactName='User 1', roomId=1, lastMessage='gkbg', lastMessageTime=2025-05-27T16:44:02.885009}
2025-06-04 20:11:18.524 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.c.ChatRestController - Contacts sorted by lastMessageTime
2025-06-04 20:11:18.524 [http-nio-0.0.0.0-8082-exec-7] INFO  i.a.u.c.a.c.c.ChatRestController - END getContacts for user 2 — returning 1 contacts
2025-06-04 20:11:18.525 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:19.966 [http-nio-0.0.0.0-8082-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ws-chat/info?t=1749042679957
2025-06-04 20:11:19.978 [http-nio-0.0.0.0-8082-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ws-chat/info?t=1749042679957
2025-06-04 20:11:19.980 [http-nio-0.0.0.0-8082-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:19.989 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ws-chat/287/vy20inln/websocket
2025-06-04 20:11:19.991 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ws-chat/287/vy20inln/websocket
2025-06-04 20:11:19.992 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:11:19.999 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: CONNECT on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:11:19.999 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:19.999 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: vy20inln
2025-06-04 20:11:19.999 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP CONNECT
2025-06-04 20:11:19.999 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Authorization headers: [Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQ5MDIzODk5LCJleHAiOjE3NDkxMTAyOTl9.Zia2plOhPwYiyUyrxmVsOrSDHr8Ix3hgODBWiiA_v-s]
2025-06-04 20:11:19.999 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Extracted token: eyJhbGciOiJIUzI1NiJ9...
2025-06-04 20:11:20.005 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - JWT token is valid
2025-06-04 20:11:20.006 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Extracted userId: 2, username: 2
2025-06-04 20:11:20.006 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully set user principal and session attributes for userId: 2
2025-06-04 20:11:20.008 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-2
2025-06-04 20:11:20.008 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.init.1
2025-06-04 20:11:20.008 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: vy20inln
2025-06-04 20:11:20.008 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:20.008 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:20.008 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:20.008 [http-nio-0.0.0.0-8082-exec-2] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:20.008 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SEND on thread: http-nio-0.0.0.0-8082-exec-2
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /app/chat.init.1
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: vy20inln
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP SEND to destination: /app/chat.init.1
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing chat init request
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Target User ID: 1
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current User ID: 2
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Chat init request authorized for user 2 with target user 1
2025-06-04 20:11:20.009 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:20.015 [clientInboundChannel-6] INFO  i.a.u.c.a.c.c.ChatWebSocketController - initRoom called - targetUserId=1
2025-06-04 20:11:20.015 [clientInboundChannel-6] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Session attributes on init: {USER_ID=2, USERNAME=2, AUTH_TOKEN=Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQ5MDIzODk5LCJleHAiOjE3NDkxMTAyOTl9.Zia2plOhPwYiyUyrxmVsOrSDHr8Ix3hgODBWiiA_v-s}
2025-06-04 20:11:20.015 [clientInboundChannel-6] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved userId from session attributes: 2
2025-06-04 20:11:20.015 [clientInboundChannel-6] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved auth token from session attributes: present
2025-06-04 20:11:20.015 [clientInboundChannel-6] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Current User ID for initRoom: 2
2025-06-04 20:11:20.015 [clientInboundChannel-6] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Auth token present: true
2025-06-04 20:11:20.059 [clientInboundChannel-6] INFO  i.a.u.c.a.c.service.ChatRoomService - Creating chat room between users 2 and 1
2025-06-04 20:11:20.059 [clientInboundChannel-6] DEBUG o.s.web.client.RestTemplate - HTTP GET http://localhost:8081/api/caregiver/2
2025-06-04 20:11:20.059 [clientInboundChannel-6] DEBUG o.s.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-06-04 20:11:20.070 [clientInboundChannel-6] DEBUG o.s.web.client.RestTemplate - Response 200 OK
2025-06-04 20:11:20.070 [clientInboundChannel-6] DEBUG o.s.web.client.RestTemplate - Reading to [java.util.Map<?, ?>]
2025-06-04 20:11:20.071 [clientInboundChannel-6] DEBUG i.a.u.c.a.c.service.ChatRoomService - User 2 is a caregiver
2025-06-04 20:11:20.071 [clientInboundChannel-6] INFO  i.a.u.c.a.c.service.ChatRoomService - Room assignment - Patient: 1, Caregiver: 2
2025-06-04 20:11:20.120 [clientInboundChannel-6] INFO  i.a.u.c.a.c.service.ChatRoomService - Found existing room with ID: 1
2025-06-04 20:11:20.147 [clientInboundChannel-6] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Room created/found with ID: 1
2025-06-04 20:11:20.147 [clientInboundChannel-6] INFO  i.a.u.c.a.c.c.ChatWebSocketController - initRoom completed successfully for roomId=1
2025-06-04 20:11:20.147 [clientInboundChannel-6] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Cleared thread-local auth token
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-3
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.1.messages
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: vy20inln
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-3
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.1.updates
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: vy20inln
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SEND on thread: http-nio-0.0.0.0-8082-exec-3
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /app/chat.history.1
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: vy20inln
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP SEND to destination: /app/chat.history.1
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing room action request
2025-06-04 20:11:20.150 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Room ID: 1
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User 2 checking membership in room 1 (pacillian: 1, caregiver: 2)
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Room action authorized for user 2 in room 1
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: UNSUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-3
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: vy20inln
2025-06-04 20:11:20.221 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - history called - roomId=1
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:20.221 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved userId from session attributes: 2
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:20.221 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - User 2 requesting history for room 1
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:20.221 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:20.289 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Retrieved 3 messages for room 1
2025-06-04 20:11:20.290 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - history completed - sent 3 messages for roomId=1
2025-06-04 20:11:43.075 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: DISCONNECT on thread: http-nio-0.0.0.0-8082-exec-6
2025-06-04 20:11:43.079 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:43.080 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:43.080 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:43.080 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:43.081 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:43.081 [http-nio-0.0.0.0-8082-exec-6] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:43.081 [http-nio-0.0.0.0-8082-exec-6] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:11:43.098 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: DISCONNECT on thread: http-nio-0.0.0.0-8082-exec-7
2025-06-04 20:11:43.098 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:11:43.098 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: zxi3fnqu
2025-06-04 20:11:43.098 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:11:43.098 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:11:43.098 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:11:43.098 [http-nio-0.0.0.0-8082-exec-7] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:11:43.098 [http-nio-0.0.0.0-8082-exec-7] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:12:43.669 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/chat
2025-06-04 20:12:43.722 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/chat
2025-06-04 20:12:43.763 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /error
2025-06-04 20:12:43.764 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:12:43.779 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8082/error?continue to session
2025-06-04 20:12:43.779 [http-nio-0.0.0.0-8082-exec-9] DEBUG o.s.s.w.a.Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
2025-06-04 20:12:51.240 [http-nio-0.0.0.0-8082-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/chat/send
2025-06-04 20:12:51.249 [http-nio-0.0.0.0-8082-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/chat/send
2025-06-04 20:12:51.253 [http-nio-0.0.0.0-8082-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /error
2025-06-04 20:12:51.254 [http-nio-0.0.0.0-8082-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:12:51.254 [http-nio-0.0.0.0-8082-exec-10] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8082/error?continue to session
2025-06-04 20:12:51.254 [http-nio-0.0.0.0-8082-exec-10] DEBUG o.s.s.w.a.Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
2025-06-04 20:14:33.244 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/validate
2025-06-04 20:14:33.255 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/validate
2025-06-04 20:14:33.262 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /error
2025-06-04 20:14:33.263 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:14:33.264 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8082/error?continue to session
2025-06-04 20:14:33.264 [http-nio-0.0.0.0-8082-exec-5] DEBUG o.s.s.w.a.Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
2025-06-04 20:15:45.640 [http-nio-0.0.0.0-8082-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contact
2025-06-04 20:15:45.658 [http-nio-0.0.0.0-8082-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contact
2025-06-04 20:15:45.666 [http-nio-0.0.0.0-8082-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2025-06-04 20:15:45.666 [http-nio-0.0.0.0-8082-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:15:45.667 [http-nio-0.0.0.0-8082-exec-3] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8082/error?continue to session
2025-06-04 20:15:45.667 [http-nio-0.0.0.0-8082-exec-3] DEBUG o.s.s.w.a.Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
2025-06-04 20:15:48.946 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts
2025-06-04 20:15:48.976 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts
2025-06-04 20:15:49.086 [http-nio-0.0.0.0-8082-exec-7] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.bind.MissingServletRequestParameterException: Required request parameter 'userId' for method parameter type Long is not present]
2025-06-04 20:15:49.088 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2025-06-04 20:15:49.088 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:15:49.089 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8082/error?continue to session
2025-06-04 20:15:49.089 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.a.Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
2025-06-04 20:17:23.251 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-06-04 20:17:23.257 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-06-04 20:17:23.269 [SpringApplicationShutdownHook] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: DISCONNECT on thread: SpringApplicationShutdownHook
2025-06-04 20:17:23.269 [SpringApplicationShutdownHook] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:17:23.270 [SpringApplicationShutdownHook] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: vy20inln
2025-06-04 20:17:23.270 [SpringApplicationShutdownHook] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:17:23.270 [SpringApplicationShutdownHook] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:17:23.270 [SpringApplicationShutdownHook] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:17:23.270 [SpringApplicationShutdownHook] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:17:23.270 [SpringApplicationShutdownHook] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:17:23.271 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-04 20:17:23.271 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@45790ed7]]
2025-06-04 20:17:23.271 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-04 20:17:23.289 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-04 20:17:23.296 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-04 20:17:23.651 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-04 20:17:28.049 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.2.Final
2025-06-04 20:17:28.071 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - Starting ChatApplication using Java 21.0.2 with PID 92549 (/Users/karolinajocelyn/IdeaProjects/chat/build/classes/java/main started by karolinajocelyn in /Users/karolinajocelyn/IdeaProjects/chat)
2025-06-04 20:17:28.072 [restartedMain] DEBUG i.a.u.c.advprog.chat.ChatApplication - Running with Spring Boot v3.4.4, Spring v6.2.5
2025-06-04 20:17:28.072 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - The following 1 profile is active: "dev"
2025-06-04 20:17:28.087 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-04 20:17:28.087 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-04 20:17:28.536 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-04 20:17:28.568 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 28 ms. Found 2 JPA repository interfaces.
2025-06-04 20:17:28.942 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8082 (http)
2025-06-04 20:17:28.951 [restartedMain] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-0.0.0.0-8082"]
2025-06-04 20:17:28.952 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-04 20:17:28.952 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.39]
2025-06-04 20:17:28.969 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-04 20:17:28.969 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 882 ms
2025-06-04 20:17:29.060 [restartedMain] DEBUG i.a.u.c.a.c.security.JwtAuthFilter - Filter 'jwtAuthFilter' configured for use
2025-06-04 20:17:29.118 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-04 20:17:29.144 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.11.Final
2025-06-04 20:17:29.157 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-04 20:17:29.277 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-04 20:17:29.290 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-04 20:17:30.475 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@12a12b0b
2025-06-04 20:17:30.476 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-04 20:17:30.571 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-04 20:17:30.656 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.5
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-04 20:17:30.998 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-04 20:17:31.185 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-04 20:17:31.462 [restartedMain] INFO  i.a.u.c.a.c.c.ChatWebSocketController - ChatWebSocketController initialized
2025-06-04 20:17:31.490 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-04 20:17:31.503 [restartedMain] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 1ca1210c-9b64-47be-988a-6a626342cc27

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-04 20:17:31.509 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-06-04 20:17:31.688 [restartedMain] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoints beneath base path '/actuator'
2025-06-04 20:17:31.728 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, JwtAuthFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-06-04 20:17:31.814 [restartedMain] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-06-04 20:17:32.118 [restartedMain] INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:postgresql://ep-odd-art-a1mbxvwl-pooler.ap-southeast-1.aws.neon.tech/neondb'
2025-06-04 20:17:32.166 [restartedMain] WARN  o.s.b.d.a.OptionalLiveReloadServer - Unable to start LiveReload server
2025-06-04 20:17:32.201 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-04 20:17:32.201 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5d37ddae]]
2025-06-04 20:17:32.202 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-04 20:17:32.202 [restartedMain] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-0.0.0.0-8082"]
2025-06-04 20:17:32.208 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8082 (http) with context path '/'
2025-06-04 20:17:32.216 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - Started ChatApplication in 4.382 seconds (process running for 4.592)
2025-06-04 20:17:35.323 [http-nio-0.0.0.0-8082-exec-1] INFO  o.a.tomcat.util.http.parser.Cookie - A cookie header was received [last_login="2024-10-27 03:30:12.196746";] that contained an invalid cookie. That cookie will be ignored.
 Note: further occurrences of this error will be logged at DEBUG level.
2025-06-04 20:17:35.340 [http-nio-0.0.0.0-8082-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-04 20:17:35.341 [http-nio-0.0.0.0-8082-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-04 20:17:35.350 [http-nio-0.0.0.0-8082-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 9 ms
2025-06-04 20:17:35.371 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ws-chat/info?t=1749043054580
2025-06-04 20:17:35.404 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ws-chat/info?t=1749043054580
2025-06-04 20:17:35.410 [http-nio-0.0.0.0-8082-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:17:35.518 [http-nio-0.0.0.0-8082-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ws-chat/004/0jz5tn3p/websocket
2025-06-04 20:17:35.519 [http-nio-0.0.0.0-8082-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ws-chat/004/0jz5tn3p/websocket
2025-06-04 20:17:35.522 [http-nio-0.0.0.0-8082-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:17:35.583 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: CONNECT on thread: http-nio-0.0.0.0-8082-exec-2
2025-06-04 20:17:35.583 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:17:35.583 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:17:35.583 [http-nio-0.0.0.0-8082-exec-2] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP CONNECT
2025-06-04 20:17:35.583 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Authorization headers: [Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQ5MDIzODk5LCJleHAiOjE3NDkxMTAyOTl9.Zia2plOhPwYiyUyrxmVsOrSDHr8Ix3hgODBWiiA_v-s]
2025-06-04 20:17:35.583 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Extracted token: eyJhbGciOiJIUzI1NiJ9...
2025-06-04 20:17:35.619 [http-nio-0.0.0.0-8082-exec-2] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - JWT token is valid
2025-06-04 20:17:35.621 [http-nio-0.0.0.0-8082-exec-2] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Extracted userId: 2, username: 2
2025-06-04 20:17:35.622 [http-nio-0.0.0.0-8082-exec-2] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully set user principal and session attributes for userId: 2
2025-06-04 20:17:35.634 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-3
2025-06-04 20:17:35.634 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.init.1
2025-06-04 20:17:35.634 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:17:35.634 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:17:35.634 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:17:35.634 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:17:35.634 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:17:35.634 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SEND on thread: http-nio-0.0.0.0-8082-exec-3
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /app/chat.init.1
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP SEND to destination: /app/chat.init.1
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing chat init request
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Target User ID: 1
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current User ID: 2
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Chat init request authorized for user 2 with target user 1
2025-06-04 20:17:35.635 [http-nio-0.0.0.0-8082-exec-3] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:17:35.639 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - initRoom called - targetUserId=1
2025-06-04 20:17:35.639 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Session attributes on init: {USER_ID=2, USERNAME=2, AUTH_TOKEN=Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzQ5MDIzODk5LCJleHAiOjE3NDkxMTAyOTl9.Zia2plOhPwYiyUyrxmVsOrSDHr8Ix3hgODBWiiA_v-s}
2025-06-04 20:17:35.639 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved userId from session attributes: 2
2025-06-04 20:17:35.639 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved auth token from session attributes: present
2025-06-04 20:17:35.639 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Current User ID for initRoom: 2
2025-06-04 20:17:35.639 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Auth token present: true
2025-06-04 20:17:35.681 [clientInboundChannel-7] INFO  i.a.u.c.a.c.service.ChatRoomService - Creating chat room between users 2 and 1
2025-06-04 20:17:35.690 [clientInboundChannel-7] DEBUG o.s.web.client.RestTemplate - HTTP GET http://localhost:8081/api/caregiver/2
2025-06-04 20:17:35.692 [clientInboundChannel-7] DEBUG o.s.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-06-04 20:17:36.007 [clientInboundChannel-7] DEBUG o.s.web.client.RestTemplate - Response 200 OK
2025-06-04 20:17:36.008 [clientInboundChannel-7] DEBUG o.s.web.client.RestTemplate - Reading to [java.util.Map<?, ?>]
2025-06-04 20:17:36.019 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.service.ChatRoomService - User 2 is a caregiver
2025-06-04 20:17:36.019 [clientInboundChannel-7] INFO  i.a.u.c.a.c.service.ChatRoomService - Room assignment - Patient: 1, Caregiver: 2
2025-06-04 20:17:36.130 [clientInboundChannel-7] INFO  i.a.u.c.a.c.service.ChatRoomService - Found existing room with ID: 1
2025-06-04 20:17:36.167 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Room created/found with ID: 1
2025-06-04 20:17:36.173 [clientInboundChannel-7] INFO  i.a.u.c.a.c.c.ChatWebSocketController - initRoom completed successfully for roomId=1
2025-06-04 20:17:36.173 [clientInboundChannel-7] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Cleared thread-local auth token
2025-06-04 20:17:36.177 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-4
2025-06-04 20:17:36.177 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.1.messages
2025-06-04 20:17:36.177 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:17:36.177 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:17:36.177 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:17:36.177 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:17:36.177 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:17:36.177 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-4
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /topic/chat.1.updates
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: SEND on thread: http-nio-0.0.0.0-8082-exec-4
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: /app/chat.history.1
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP SEND to destination: /app/chat.history.1
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing room action request
2025-06-04 20:17:36.178 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Room ID: 1
2025-06-04 20:17:36.257 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User 2 checking membership in room 1 (pacillian: 1, caregiver: 2)
2025-06-04 20:17:36.257 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Room action authorized for user 2 in room 1
2025-06-04 20:17:36.257 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:17:36.257 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: UNSUBSCRIBE on thread: http-nio-0.0.0.0-8082-exec-4
2025-06-04 20:17:36.257 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:17:36.258 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:17:36.258 [clientInboundChannel-16] INFO  i.a.u.c.a.c.c.ChatWebSocketController - history called - roomId=1
2025-06-04 20:17:36.258 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:17:36.258 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - Retrieved userId from session attributes: 2
2025-06-04 20:17:36.258 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:17:36.258 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - User 2 requesting history for room 1
2025-06-04 20:17:36.258 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:17:36.258 [http-nio-0.0.0.0-8082-exec-4] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:17:36.258 [http-nio-0.0.0.0-8082-exec-4] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:17:36.374 [clientInboundChannel-16] INFO  i.a.u.c.a.c.c.ChatWebSocketController - Retrieved 3 messages for room 1
2025-06-04 20:17:36.391 [clientInboundChannel-16] DEBUG i.a.u.c.a.c.c.ChatWebSocketController - history completed - sent 3 messages for roomId=1
2025-06-04 20:17:44.001 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/chat/contacts
2025-06-04 20:17:44.011 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/chat/contacts
2025-06-04 20:17:44.032 [http-nio-0.0.0.0-8082-exec-7] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.bind.MissingServletRequestParameterException: Required request parameter 'userId' for method parameter type Long is not present]
2025-06-04 20:17:44.038 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2025-06-04 20:17:44.039 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-06-04 20:17:44.048 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8082/error?continue to session
2025-06-04 20:17:44.053 [http-nio-0.0.0.0-8082-exec-7] DEBUG o.s.s.w.a.Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
2025-06-04 20:18:32.238 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 16, active threads = 0, queued tasks = 0, completed tasks = 21], outboundChannel[pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 5], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 14]
2025-06-04 20:34:21.027 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: DISCONNECT on thread: http-nio-0.0.0.0-8082-exec-9
2025-06-04 20:34:21.097 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:34:21.100 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:34:21.106 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:34:21.111 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:34:21.113 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:34:21.115 [http-nio-0.0.0.0-8082-exec-9] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:34:21.115 [http-nio-0.0.0.0-8082-exec-9] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:34:21.646 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Processing STOMP command: DISCONNECT on thread: http-nio-0.0.0.0-8082-exec-10
2025-06-04 20:34:21.647 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Destination: null
2025-06-04 20:34:21.647 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session ID: 0jz5tn3p
2025-06-04 20:34:21.647 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Current user principal: null
2025-06-04 20:34:21.647 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - User principal is null, attempting to get from session attributes
2025-06-04 20:34:21.647 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Session attributes - userId: 2, username: 2, authToken: present
2025-06-04 20:34:21.647 [http-nio-0.0.0.0-8082-exec-10] INFO  i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Successfully restored user principal from session for userId: 2
2025-06-04 20:34:21.648 [http-nio-0.0.0.0-8082-exec-10] DEBUG i.a.u.c.a.c.s.JwtAuthChannelInterceptor - Message processing completed successfully
2025-06-04 20:48:32.383 [MessageBroker-6] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 27], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 7], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 413]
2025-06-04 21:18:32.479 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 27], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 7], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 774]
2025-06-04 21:36:54.659 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m53s18ms).
2025-06-04 21:38:25.914 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1m31s377ms).
2025-06-04 21:52:09.801 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=13m13s869ms).
2025-06-04 21:54:40.640 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=2m30s839ms).
2025-06-04 22:06:48.727 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=11m38s78ms).
2025-06-04 22:32:54.382 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 27], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 7], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 1135]
2025-06-04 22:39:40.328 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-06-04 22:39:40.427 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-06-04 22:39:40.469 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-04 22:39:40.472 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5d37ddae]]
2025-06-04 22:39:40.472 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-04 22:39:40.532 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-04 22:39:40.606 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-04 22:39:40.624 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-04 22:39:44.576 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.2.Final
2025-06-04 22:39:44.603 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - Starting ChatApplication using Java 21.0.2 with PID 95450 (/Users/karolinajocelyn/IdeaProjects/chat/build/classes/java/main started by karolinajocelyn in /Users/karolinajocelyn/IdeaProjects/chat)
2025-06-04 22:39:44.603 [restartedMain] DEBUG i.a.u.c.advprog.chat.ChatApplication - Running with Spring Boot v3.4.4, Spring v6.2.5
2025-06-04 22:39:44.604 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - The following 1 profile is active: "dev"
2025-06-04 22:39:44.624 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-04 22:39:44.624 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-04 22:39:45.024 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-04 22:39:45.050 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 21 ms. Found 2 JPA repository interfaces.
2025-06-04 22:39:45.400 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8082 (http)
2025-06-04 22:39:45.410 [restartedMain] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-0.0.0.0-8082"]
2025-06-04 22:39:45.411 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-04 22:39:45.411 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.39]
2025-06-04 22:39:45.428 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-04 22:39:45.428 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 804 ms
2025-06-04 22:39:45.514 [restartedMain] DEBUG i.a.u.c.a.c.security.JwtAuthFilter - Filter 'jwtAuthFilter' configured for use
2025-06-04 22:39:45.572 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-04 22:39:45.598 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.11.Final
2025-06-04 22:39:45.611 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-04 22:39:45.720 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-04 22:39:45.732 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-04 22:39:47.260 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@45693cd0
2025-06-04 22:39:47.262 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-04 22:39:47.367 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-04 22:39:47.500 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 17.5
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-04 22:39:47.938 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-04 22:39:48.182 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-04 22:39:48.470 [restartedMain] INFO  i.a.u.c.a.c.c.ChatWebSocketController - ChatWebSocketController initialized
2025-06-04 22:39:48.496 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-04 22:39:48.512 [restartedMain] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: bcffb54c-dece-46da-ac1e-0a48c9e7673a

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-04 22:39:48.519 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-06-04 22:39:49.023 [restartedMain] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoints beneath base path '/actuator'
2025-06-04 22:39:49.090 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, JwtAuthFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-06-04 22:39:49.193 [restartedMain] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-06-04 22:39:49.560 [restartedMain] INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:postgresql://ep-odd-art-a1mbxvwl-pooler.ap-southeast-1.aws.neon.tech/neondb'
2025-06-04 22:39:49.592 [restartedMain] WARN  o.s.b.d.a.OptionalLiveReloadServer - Unable to start LiveReload server
2025-06-04 22:39:49.618 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-04 22:39:49.619 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@4470ea8d]]
2025-06-04 22:39:49.619 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-04 22:39:49.619 [restartedMain] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-0.0.0.0-8082"]
2025-06-04 22:39:49.626 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8082 (http) with context path '/'
2025-06-04 22:39:49.634 [restartedMain] INFO  i.a.u.c.advprog.chat.ChatApplication - Started ChatApplication in 5.251 seconds (process running for 5.467)
2025-06-04 22:39:51.854 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-06-04 22:39:51.859 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-06-04 22:39:51.860 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-04 22:39:51.860 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@4470ea8d]]
2025-06-04 22:39:51.860 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-04 22:39:51.863 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-04 22:39:51.866 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-04 22:39:52.328 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
